<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë°˜ì‘ ì—­ì „ ëŸ¬ë„ˆ - ë ˆì„œíŒë‹¤ vs ëˆˆí‘œë²”</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Press Start 2P', sans-serif;
      text-align: center;
      margin: 0;
      overflow: hidden;
    }
    .start-screen, .hud, .gameover-screen {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    .start-screen {
      top: 50%;
      transform: translate(-50%, -50%);
    }
    .hud {
      top: 10px;
      background: rgba(0,0,0,0.3);
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 12px;
      display: none;
    }
    .gameover-screen {
      top: 40%;
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border: 2px solid #fff;
      border-radius: 8px;
      display: none;
    }
    .btn {
      margin-top: 10px;
      display: inline-block;
      background: #4caf50;
      color: #fff;
      padding: 8px 16px;
      text-decoration: none;
      cursor: pointer;
      border-radius: 6px;
      font-size: 12px;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(to bottom, #6ec6ff 0%, #b3e5fc 50%, #81c784 80%, #4caf50 100%);
    }
  </style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div class="start-screen" id="startScreen">
    <h2>ğŸ¦Š ë ˆì„œíŒë‹¤ vs ëˆˆí‘œë²” ğŸ†</h2>
    <p>â— ë°˜ëŒ€ ë°©í–¥í‚¤ë¡œ í”¼í•˜ê¸° (â† â†’ â†‘)</p>
    <div class="btn" id="startBtn" disabled>Loading...</div>
  </div>

  <!-- HUD -->
  <div class="hud" id="hud">
    ìƒì¡´ ì‹œê°„: <span id="time">0.0ì´ˆ</span>
  </div>

  <!-- ê²Œì„ì˜¤ë²„ í™”ë©´ -->
  <div class="gameover-screen" id="gameOverScreen">
    <h2>GAME OVER</h2>
    <p id="finalTime">ìƒì¡´ ì‹œê°„: 0.0ì´ˆ</p>
    <div class="btn" id="retryBtn">RETRY</div>
  </div>

  <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
  <canvas id="gameCanvas" width="720" height="720"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const startScreen = document.getElementById("startScreen");
    const hud = document.getElementById("hud");
    const timeDisplay = document.getElementById("time");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const finalTimeDisplay = document.getElementById("finalTime");
    const startBtn = document.getElementById("startBtn");
    const retryBtn = document.getElementById("retryBtn");

    // ê²Œì„ ì„¤ì •
    const laneWidth = 240;
    const lanePositions = [
      laneWidth / 2,
      laneWidth + laneWidth / 2,
      laneWidth * 2 + laneWidth / 2
    ];
    const playerY = 600;
    const playerWidth = 80;
    const playerHeight = 80;
    const obstacleYStart = -80;

    let gameStarted = false;
    let playerLane = 1;
    let gameOver = false;

    let obstacles = [];
    let speed = 4;           // ì‹œì‘ ì†ë„ ëŠë¦¬ê²Œ
    let spawnTimer = 0;
    let difficultyTimer = 0;
    let spawnInterval = 60;  // 60í”„ë ˆì„(1ì´ˆ)ë§ˆë‹¤ 1ê°œ ìƒì„±

    // ê°™ì€ ë ˆì¸ ì—°ì† 2íšŒ ë°©ì§€ ê¸°ë¡
    let lastLane = null;
    let repeatCount = 0;

    // ìƒì¡´ ì‹œê°„
    let startTime = null;
    let survivalTime = 0;
    let timeInterval = null;

    // ì´ë¯¸ì§€ ë¡œë“œ
    const playerImg = new Image();
    playerImg.src = "player.png";  // ê°™ì€ í´ë”ì— ë ˆì„œíŒë‹¤
    const enemyImg = new Image();
    enemyImg.src = "enemy.png";    // ê°™ì€ í´ë”ì— ëˆˆí‘œë²”

    // êµ¬ë¦„
    let clouds = [
      {x:100, y:80, speed:0.3},
      {x:400, y:50, speed:0.2},
      {x:650, y:120, speed:0.4}
    ];

    // ì´ë¯¸ì§€ ë¡œë”© í›„ START ë²„íŠ¼ í™œì„±í™”
    let assetsLoaded = 0;
    const totalAssets = 2;
    playerImg.onload = () => { assetsLoaded++; if (assetsLoaded === totalAssets) enableStart(); };
    enemyImg.onload = () => { assetsLoaded++; if (assetsLoaded === totalAssets) enableStart(); };

    function enableStart() {
      startBtn.disabled = false;
      startBtn.innerText = "START GAME";
    }

    function drawBackground() {
      let gradient = ctx.createLinearGradient(0,0,0,canvas.height);
      gradient.addColorStop(0, '#6ec6ff');
      gradient.addColorStop(0.5, '#b3e5fc');
      gradient.addColorStop(0.8, '#81c784');
      gradient.addColorStop(1, '#4caf50');
      ctx.fillStyle = gradient;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle = "rgba(255,255,255,0.8)";
      clouds.forEach(cloud=>{
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, 30, 0, Math.PI*2);
        ctx.arc(cloud.x+40, cloud.y+10, 25, 0, Math.PI*2);
        ctx.arc(cloud.x-40, cloud.y+10, 25, 0, Math.PI*2);
        ctx.fill();

        cloud.x += cloud.speed;
        if(cloud.x>canvas.width+50) cloud.x=-50;
      });
    }

    function drawLanes() {
      ctx.strokeStyle = "rgba(255,255,255,0.2)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(240, 0);
      ctx.lineTo(240, canvas.height);
      ctx.moveTo(480, 0);
      ctx.lineTo(480, canvas.height);
      ctx.stroke();
    }

    function drawPlayer() {
      ctx.drawImage(playerImg, lanePositions[playerLane] - 40, playerY, 80, 80);
    }

    function drawObstacle(o) {
      ctx.drawImage(enemyImg, lanePositions[o.lane] - 40, o.y, 80, 80);
    }

    function spawnObstacle() {
      let randomLane = Math.floor(Math.random() * 3);

      // âœ… ê°™ì€ ë ˆì¸ ì—°ì† 2íšŒ ë°©ì§€
      if (randomLane === lastLane) {
        repeatCount++;
        if (repeatCount >= 2) {
          // ê°•ì œë¡œ ë‹¤ë¥¸ ë ˆì¸ ì„ íƒ
          let availableLanes = [0,1,2].filter(l => l !== lastLane);
          randomLane = availableLanes[Math.floor(Math.random() * availableLanes.length)];
          repeatCount = 0; // ì´ˆê¸°í™”
        }
      } else {
        repeatCount = 0;
      }

      lastLane = randomLane;
      obstacles.push({ lane: randomLane, y: obstacleYStart });
    }

    function updateObstacles() {
      for (let o of obstacles) {
        o.y += speed;
      }
      obstacles = obstacles.filter(o => o.y <= canvas.height + 100);
    }

    function checkCollision() {
      for (let o of obstacles) {
        if (o.y + playerHeight > playerY && o.y < playerY + playerHeight) {
          if (o.lane === playerLane) {
            gameOver = true;
          }
        }
      }
    }

    function startTimer() {
      startTime = performance.now();
      timeInterval = setInterval(() => {
        let now = performance.now();
        survivalTime = ((now - startTime) / 1000).toFixed(1);
        timeDisplay.innerText = `${survivalTime}ì´ˆ`;
      }, 100);
    }

    function stopTimer() {
      clearInterval(timeInterval);
    }

    function resetGame() {
      obstacles = [];
      speed = 4;           // ì´ˆê¸° ì†ë„
      spawnTimer = 0;
      difficultyTimer = 0;
      playerLane = 1;
      lastLane = null;
      repeatCount = 0;
      gameOver = false;
      survivalTime = 0;
      timeDisplay.innerText = `0.0ì´ˆ`;
    }

    function startGame() {
      gameStarted = true;
      resetGame();
      spawnObstacle(); // ì‹œì‘í•˜ìë§ˆì í•˜ë‚˜ ìƒì„±
      startScreen.style.display = "none";
      hud.style.display = "block";
      gameOverScreen.style.display = "none";
      startTimer();
      gameLoop();
    }

    function showGameOver() {
      stopTimer();
      finalTimeDisplay.innerText = `ìƒì¡´ ì‹œê°„: ${survivalTime}ì´ˆ`;
      gameOverScreen.style.display = "block";
    }

    function gameLoop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if (!gameOver) {
        drawBackground();
        drawLanes();
        drawPlayer();

        updateObstacles();
        for (let o of obstacles) {
          drawObstacle(o);
        }
        checkCollision();

        spawnTimer++;
        difficultyTimer++;

        // âœ… ì¼ì • ê°„ê²©ìœ¼ë¡œë§Œ spawn (ëœë¤X)
        if (spawnTimer > spawnInterval) {
          spawnObstacle();
          spawnTimer = 0;
        }

        // âœ… ì†ë„ëŠ” ì¼ì •í•˜ê²Œ ë¹¨ë¼ì§
        if (difficultyTimer > 300) {
          if (speed < 40) speed += 2;  // ì¼ì • ì£¼ê¸°ë¡œ ë¹¨ë¼ì§
          difficultyTimer = 0;
        }

        requestAnimationFrame(gameLoop);
      } else {
        showGameOver();
      }
    }

    // ë°©í–¥í‚¤ ë°˜ëŒ€ë¡œ
    document.addEventListener("keydown", (e) => {
      if (!gameStarted) return;
      if (gameOver) return;

      if (e.code === "ArrowLeft") {
        if(playerLane < 2) playerLane++;  // ë°˜ëŒ€ ë°©í–¥
      } else if (e.code === "ArrowRight") {
        if(playerLane > 0) playerLane--;  // ë°˜ëŒ€ ë°©í–¥
      } else if (e.code === "ArrowUp") {
        playerLane = 1;
      }
    });

    startBtn.addEventListener("click", () => {
      if (!startBtn.disabled) startGame();
    });

    retryBtn.addEventListener("click", () => {
      startGame();
    });
  </script>
</body>
</html>
